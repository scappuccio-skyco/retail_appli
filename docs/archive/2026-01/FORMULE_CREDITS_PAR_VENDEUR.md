# üí° FORMULE : Cr√©dits IA en fonction du nombre de vendeurs

## üéØ PRINCIPE

**Id√©e :** Les cr√©dits IA augmentent proportionnellement au nombre de vendeurs achet√©s

**Pourquoi c'est mieux ?**
- ‚úÖ Plus juste : Une √©quipe de 15 vendeurs utilise plus l'IA qu'une √©quipe de 3
- ‚úÖ Scalable : Grandit naturellement avec l'√©quipe
- ‚úÖ Simple √† comprendre pour les clients
- ‚úÖ Coh√©rent avec le pricing "par vendeur"

---

## üìä FORMULES PROPOS√âES

### OPTION 1 : Cr√©dits fixes par vendeur (SIMPLE)

**Formule :** `Cr√©dits totaux = Nombre de vendeurs √ó Cr√©dits par vendeur`

#### Variante 1A : 100 cr√©dits/vendeur

| Plan | Vendeurs | Calcul | Cr√©dits totaux |
|------|----------|--------|----------------|
| Starter | 1 | 1 √ó 100 | 100 |
| Starter | 5 | 5 √ó 100 | 500 |
| Professional | 6 | 6 √ó 100 | 600 |
| Professional | 15 | 15 √ó 100 | 1500 |

**Avantages :**
- ‚úÖ Ultra simple : "100 cr√©dits par vendeur"
- ‚úÖ Parfaitement proportionnel
- ‚úÖ Facile √† communiquer

**Inconv√©nients :**
- ‚ö†Ô∏è Pas de bonus pour le manager
- ‚ö†Ô∏è Une √©quipe de 1 vendeur n'a que 100 cr√©dits (peut √™tre juste)

---

#### Variante 1B : 150 cr√©dits/vendeur (PLUS G√âN√âREUX)

| Plan | Vendeurs | Calcul | Cr√©dits totaux |
|------|----------|--------|----------------|
| Starter | 1 | 1 √ó 150 | 150 |
| Starter | 5 | 5 √ó 150 | 750 |
| Professional | 6 | 6 √ó 150 | 900 |
| Professional | 15 | 15 √ó 150 | 2250 |

**Avantages :**
- ‚úÖ Plus confortable pour les petites √©quipes
- ‚úÖ Marge de s√©curit√© importante

**Inconv√©nients :**
- ‚ö†Ô∏è Peut √™tre trop g√©n√©reux (mais co√ªt reste < 1‚Ç¨/client)

---

### OPTION 2 : Cr√©dits de base + par vendeur (HYBRIDE) ‚≠ê RECOMMAND√â

**Formule :** `Cr√©dits totaux = Cr√©dits de base (manager) + (Nombre de vendeurs √ó Cr√©dits par vendeur)`

#### Variante 2A : Base 200 + 80 par vendeur

| Plan | Vendeurs | Calcul | Cr√©dits totaux | Usage r√©el estim√© | Marge |
|------|----------|--------|----------------|-------------------|-------|
| Starter | 1 | 200 + (1√ó80) | **280** | ~110 | 61% ‚úÖ |
| Starter | 3 | 200 + (3√ó80) | **440** | ~170 | 61% ‚úÖ |
| Starter | 5 | 200 + (5√ó80) | **600** | ~230 | 62% ‚úÖ |
| Professional | 6 | 200 + (6√ó80) | **680** | ~280 | 59% ‚úÖ |
| Professional | 10 | 200 + (10√ó80) | **1000** | ~430 | 57% ‚úÖ |
| Professional | 15 | 200 + (15√ó80) | **1400** | ~605 | 57% ‚úÖ |

**Avantages :**
- ‚úÖ Juste pour toutes les tailles d'√©quipe
- ‚úÖ Le manager a toujours 200 cr√©dits garantis
- ‚úÖ Chaque vendeur apporte 80 cr√©dits
- ‚úÖ Marge de ~60% constante
- ‚úÖ Simple √† expliquer : "200 pour vous + 80 par vendeur"

**Communication client :**
> "Chaque vendeur b√©n√©ficie de son propre quota de coaching IA (80 cr√©dits), 
> et vous disposez en plus de 200 cr√©dits d√©di√©s √† vos analyses d'√©quipe."

---

#### Variante 2B : Base 250 + 100 par vendeur (G√âN√âREUX)

| Plan | Vendeurs | Calcul | Cr√©dits totaux | Usage r√©el estim√© | Marge |
|------|----------|--------|----------------|-------------------|-------|
| Starter | 1 | 250 + (1√ó100) | **350** | ~110 | 69% ‚úÖ |
| Starter | 5 | 250 + (5√ó100) | **750** | ~230 | 69% ‚úÖ |
| Professional | 15 | 250 + (15√ó100) | **1750** | ~605 | 65% ‚úÖ |

**Avantages :**
- ‚úÖ Tr√®s confortable pour tous
- ‚úÖ Excellent argument marketing

**Inconv√©nients :**
- ‚ö†Ô∏è Peut-√™tre trop g√©n√©reux (mais toujours rentable)

---

#### Variante 2C : Base 150 + 70 par vendeur (√âCONOMIQUE)

| Plan | Vendeurs | Calcul | Cr√©dits totaux | Usage r√©el estim√© | Marge |
|------|----------|--------|----------------|-------------------|-------|
| Starter | 1 | 150 + (1√ó70) | **220** | ~110 | 50% ‚ö†Ô∏è |
| Starter | 5 | 150 + (5√ó70) | **500** | ~230 | 54% ‚úÖ |
| Professional | 15 | 150 + (15√ó70) | **1200** | ~605 | 50% ‚ö†Ô∏è |

**Avantages :**
- ‚úÖ Plus √©conomique
- ‚úÖ Marge raisonnable

**Inconv√©nients :**
- ‚ö†Ô∏è Marge un peu juste (~50%)
- ‚ö†Ô∏è Petites √©quipes moins avantag√©es

---

### OPTION 3 : Paliers progressifs (MARKETING)

**Formule :** Plus vous avez de vendeurs, plus le bonus par vendeur augmente

| Taille √©quipe | Cr√©dits de base | Cr√©dits par vendeur | Total (max) |
|---------------|-----------------|---------------------|-------------|
| 1-2 vendeurs | 200 | 100 | 200 + (2√ó100) = **400** |
| 3-5 vendeurs | 200 | 90 | 200 + (5√ó90) = **650** |
| 6-10 vendeurs | 250 | 85 | 250 + (10√ó85) = **1100** |
| 11-15 vendeurs | 300 | 80 | 300 + (15√ó80) = **1500** |

**Avantages :**
- ‚úÖ Favorise les petites √©quipes (d√©marrage)
- ‚úÖ Reste attractif pour les grandes √©quipes
- ‚úÖ Diff√©renciation marketing

**Inconv√©nients :**
- ‚ö†Ô∏è Plus complexe √† expliquer
- ‚ö†Ô∏è Calcul plus compliqu√©

---

## üèÜ MA RECOMMANDATION : Variante 2A

### Formule finale recommand√©e

```
Cr√©dits IA mensuels = 200 + (Nombre de si√®ges achet√©s √ó 80)
```

### Exemples concrets

**Manager avec 3 vendeurs (Starter) :**
- 200 cr√©dits pour le manager (analyses √©quipe, KPI, conflits)
- 3 √ó 80 = 240 cr√©dits pour les vendeurs (d√©briefs, √©valuations, challenges)
- **Total : 440 cr√©dits/mois**

**Manager avec 12 vendeurs (Professional) :**
- 200 cr√©dits pour le manager
- 12 √ó 80 = 960 cr√©dits pour les vendeurs
- **Total : 1160 cr√©dits/mois**

---

## üí∞ ANALYSE DES CO√õTS R√âELS

### Sc√©narios avec la formule recommand√©e (200 + 80√ósi√®ges)

| Si√®ges | Cr√©dits totaux | Usage r√©aliste | Co√ªt r√©el ‚Ç¨ | Revenu ‚Ç¨ | Ratio |
|--------|----------------|----------------|-------------|----------|-------|
| 1 | 280 | ~110 | 0.05‚Ç¨ | 29‚Ç¨ | 0.17% |
| 3 | 440 | ~170 | 0.10‚Ç¨ | 87‚Ç¨ | 0.11% |
| 5 | 600 | ~230 | 0.15‚Ç¨ | 145‚Ç¨ | 0.10% |
| 10 | 1000 | ~430 | 0.30‚Ç¨ | 250‚Ç¨ | 0.12% |
| 15 | 1400 | ~605 | 0.45‚Ç¨ | 375‚Ç¨ | 0.12% |

**Conclusion :** Co√ªt IA reste **< 0.20% du CA** ‚Üí ‚úÖ **Excellent**

---

## üé® COMMUNICATION MARKETING

### Version 1 : Simple et directe

**Plan Starter**
> ‚ú® **Coaching IA inclus**
> - 200 cr√©dits manager + 80 cr√©dits par vendeur/mois
> - D√©briefs IA illimit√©s pour votre √©quipe
> - Analyses personnalis√©es automatiques

**Plan Professional**
> ‚ú® **Coaching IA avanc√©**
> - 200 cr√©dits manager + 80 cr√©dits par vendeur/mois
> - Bilans d'√©quipe IA mensuels
> - R√©solution de conflits assist√©e par IA
> - Analyses KPI magasin en temps r√©el

---

### Version 2 : Focus b√©n√©fice (sans mentionner "cr√©dits")

**Plan Starter**
> ‚ú® **IA illimit√©e pour votre √©quipe**
> - Chaque vendeur b√©n√©ficie d'un coaching IA personnalis√©
> - D√©briefs de vente analys√©s automatiquement
> - Challenges quotidiens adapt√©s au profil
> - Dashboard manager avec insights IA

---

### Version 3 : Valeur per√ßue

**Plan Starter**
> ‚ú® **+ de 400 analyses IA incluses/mois**
> - Coaching IA pour chaque membre de l'√©quipe
> - D√©briefs, √©valuations, d√©fis quotidiens
> - Analyses d'√©quipe et KPI magasin
> 
> *Cr√©dits proportionnels √† la taille de votre √©quipe*

---

## üíª IMPL√âMENTATION TECHNIQUE

### 1. Fonction de calcul des cr√©dits

```python
# Dans server.py

def calculate_monthly_ai_credits(seats: int, plan: str = None) -> int:
    """
    Calcule les cr√©dits IA mensuels selon le nombre de si√®ges
    Formule : 200 (base manager) + (80 √ó nombre de si√®ges)
    """
    BASE_CREDITS = 200  # Pour les analyses manager
    CREDITS_PER_SEAT = 80  # Pour chaque vendeur
    
    total_credits = BASE_CREDITS + (seats * CREDITS_PER_SEAT)
    
    return total_credits

# Exemple d'utilisation
# 5 si√®ges ‚Üí 200 + (5 √ó 80) = 600 cr√©dits
```

### 2. Lors de l'activation de l'abonnement

```python
# Dans le webhook Stripe ou lors de la cr√©ation d'abonnement

@api_router.post("/webhook/stripe")
async def stripe_webhook(request: Request):
    # ... votre code existant ...
    
    if event['type'] == 'checkout.session.completed':
        session = event['data']['object']
        workspace_id = session['metadata'].get('workspace_id')
        
        # R√©cup√©rer le nombre de si√®ges achet√©s
        line_items = stripe.checkout.Session.list_line_items(session.id)
        seats = line_items.data[0].quantity if line_items.data else 1
        
        # Calculer les cr√©dits selon la formule
        monthly_credits = calculate_monthly_ai_credits(seats)
        
        # Mettre √† jour le workspace
        await db.workspaces.update_one(
            {"id": workspace_id},
            {"$set": {
                "ai_credits_remaining": monthly_credits,
                "ai_credits_used_this_month": 0,
                "stripe_quantity": seats,
                "last_credit_reset": datetime.now(timezone.utc).isoformat()
            }}
        )
```

### 3. Lors du changement de si√®ges

```python
# Endpoint de modification des si√®ges

@api_router.post("/subscription/change-seats")
async def change_seats(
    request_data: dict,
    current_user: dict = Depends(get_current_user)
):
    # ... votre code existant ...
    
    new_seats = request_data.get('new_seats')
    
    # Modifier sur Stripe
    stripe.Subscription.modify(
        subscription_id,
        items=[{
            'id': subscription_item_id,
            'quantity': new_seats,
        }]
    )
    
    # Recalculer les cr√©dits pour le nouveau nombre de si√®ges
    new_credits_limit = calculate_monthly_ai_credits(new_seats)
    
    # Ajuster les cr√©dits restants proportionnellement
    workspace = await db.workspaces.find_one({"id": workspace_id})
    old_credits_limit = 200 + (workspace['stripe_quantity'] * 80)
    old_credits_remaining = workspace.get('ai_credits_remaining', 0)
    
    # Proportion : si 50% restaient, on garde 50% du nouveau forfait
    usage_ratio = old_credits_remaining / old_credits_limit if old_credits_limit > 0 else 1
    new_credits_remaining = int(new_credits_limit * usage_ratio)
    
    await db.workspaces.update_one(
        {"id": workspace_id},
        {"$set": {
            "stripe_quantity": new_seats,
            "ai_credits_remaining": new_credits_remaining
        }}
    )
```

### 4. R√©initialisation mensuelle

```python
# Fonction de reset mensuel

async def check_and_reset_monthly_credits_workspace(workspace_id: str):
    """
    V√©rifie si le mois a chang√© et r√©initialise les cr√©dits si besoin
    """
    workspace = await db.workspaces.find_one({"id": workspace_id})
    
    if not workspace:
        return
    
    last_reset = workspace.get('last_credit_reset')
    if not last_reset:
        return
    
    last_reset_date = datetime.fromisoformat(last_reset)
    now = datetime.now(timezone.utc)
    
    # Si on est dans un nouveau mois
    if now.year > last_reset_date.year or now.month > last_reset_date.month:
        # Recalculer les cr√©dits selon le nombre de si√®ges actuel
        seats = workspace.get('stripe_quantity', 1)
        monthly_credits = calculate_monthly_ai_credits(seats)
        
        await db.workspaces.update_one(
            {"id": workspace_id},
            {"$set": {
                "ai_credits_remaining": monthly_credits,
                "ai_credits_used_this_month": 0,
                "last_credit_reset": now.isoformat()
            }}
        )
```

---

## üìä COMPARAISON : AVANT vs APR√àS

### AVANT (forfaits fixes)

| Plan | Cr√©dits | Pour qui | Probl√®me |
|------|---------|----------|----------|
| Starter | 500 | 1-5 vendeurs | ‚ö†Ô∏è 1 vendeur a trop, 5 ont juste assez |
| Professional | 1500 | 6-15 vendeurs | ‚ö†Ô∏è 6 vendeurs ont trop, 15 ont pile |

### APR√àS (proportionnel)

| Si√®ges | Cr√©dits (200+80√ó) | R√©partition | R√©sultat |
|--------|-------------------|-------------|----------|
| 1 | 280 | Manager: 200, Vendeur: 80 | ‚úÖ √âquilibr√© |
| 5 | 600 | Manager: 200, Vendeurs: 400 | ‚úÖ √âquilibr√© |
| 15 | 1400 | Manager: 200, Vendeurs: 1200 | ‚úÖ √âquilibr√© |

**B√©n√©fice :** Marge de ~60% constante, quelle que soit la taille de l'√©quipe !

---

## ‚úÖ PROCHAINES √âTAPES

1. **Validez la formule :** 200 + (80 √ó si√®ges) ou une autre variante ?
2. **Je modifie le code** pour impl√©menter le calcul dynamique
3. **Je mets √† jour** tous les documents (simulations, recommandations)
4. **Je pr√©pare** le texte marketing pour vos pages de pricing

**Quelle formule pr√©f√©rez-vous ?**
- A) 200 + (80 √ó si√®ges) - ‚≠ê **Recommand√©**
- B) 250 + (100 √ó si√®ges) - Plus g√©n√©reux
- C) 150 + (70 √ó si√®ges) - Plus √©conomique
- D) Autre formule ? (pr√©cisez)

En attente de votre validation ! üöÄ
