# üìã CURSOR RULES - RETAIL PERFORMER AI
## Source de V√©rit√© pour le D√©veloppement

**‚ö†Ô∏è IMPORTANT**: Ce document DOIT √™tre mis √† jour √† chaque modification significative de l'application.
**Derni√®re mise √† jour**: 28 Janvier 2026

---

## üö® R√àGLES CRITIQUES (Architecture Backend)

**√Ä respecter en priorit√©** (refactoring post-audit):

1. **Architecture**
   - Les **Services** ne doivent **JAMAIS** acc√©der √† `self.db`. Ils doivent utiliser des **Repositories** inject√©s (ex: `self.user_repo`, `self.store_repo`).
   - Routes ‚Üí Services ‚Üí Repositories ‚Üí Database (pas de bypass).

2. **Erreurs**
   - **Ne jamais** utiliser `HTTPException(500)`. Utiliser des **exceptions m√©tier** : `NotFoundError`, `ValidationError`, `ForbiddenError`, `UnauthorizedError`, etc. (voir `exceptions/custom_exceptions.py`).
   - Le `ErrorHandlerMiddleware` convertit ces exceptions en r√©ponses HTTP avec le bon status_code.

3. **Pagination**
   - Toute **liste** retourn√©e par l‚ÄôAPI doit √™tre **pagin√©e**. Pas de `.to_list(1000)`. Utiliser `paginate()`, `PaginatedResponse`, et les param√®tres `page`/`limit` (max 100 par page).

4. **Logs**
   - Utiliser **`logger`** (module `logging`), **jamais** `print`. Exemple : `logger.info(...)`, `logger.warning(...)`, `logger.error(...)`.

---

## üéØ R√àGLE FONDAMENTALE

**NE JAMAIS DUPLIQUER** du code, des fonctions, ou des patterns d√©j√† existants. Toujours v√©rifier ce document et le codebase avant d'ajouter du nouveau code.

---

## üìê ARCHITECTURE ACTUELLE

### Structure Backend (Clean Architecture)

```
backend/
‚îú‚îÄ‚îÄ main.py                    # Entrypoint FastAPI (version 2.0.0)
‚îú‚îÄ‚îÄ core/                      # Infrastructure layer
‚îÇ   ‚îú‚îÄ‚îÄ config.py             # Pydantic Settings (singleton)
‚îÇ   ‚îú‚îÄ‚îÄ database.py           # MongoDB connection pool (maxPoolSize=50 ‚úÖ Production-ready)
‚îÇ   ‚îî‚îÄ‚îÄ security.py           # JWT, bcrypt, RBAC dependencies
‚îú‚îÄ‚îÄ models/                    # Domain layer (73 mod√®les Pydantic)
‚îÇ   ‚îú‚îÄ‚îÄ users.py              # User, Seller, Manager, G√©rant
‚îÇ   ‚îú‚îÄ‚îÄ kpis.py               # KPIEntry, ManagerKPI, StoreKPI
‚îÇ   ‚îú‚îÄ‚îÄ stores.py             # Store, Workspace
‚îÇ   ‚îú‚îÄ‚îÄ subscriptions.py      # Subscription, PaymentTransaction
‚îÇ   ‚îú‚îÄ‚îÄ diagnostics.py        # DiagnosticResult, ManagerDiagnosticResult
‚îÇ   ‚îú‚îÄ‚îÄ challenges.py         # Challenge, DailyChallenge
‚îÇ   ‚îú‚îÄ‚îÄ objectives.py         # ManagerObjectives
‚îÇ   ‚îú‚îÄ‚îÄ sales.py              # Sale, Evaluation, Debrief
‚îÇ   ‚îú‚îÄ‚îÄ integrations.py       # APIKey, KPISyncRequest
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ repositories/              # Data Access layer (11 repositories)
‚îÇ   ‚îú‚îÄ‚îÄ base_repository.py    # BaseRepository pattern (CRUD commun)
‚îÇ   ‚îú‚îÄ‚îÄ user_repository.py
‚îÇ   ‚îú‚îÄ‚îÄ kpi_repository.py
‚îÇ   ‚îú‚îÄ‚îÄ store_repository.py
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ services/                  # Business Logic layer (16 services)
‚îÇ   ‚îú‚îÄ‚îÄ auth_service.py
‚îÇ   ‚îú‚îÄ‚îÄ kpi_service.py
‚îÇ   ‚îú‚îÄ‚îÄ ai_service.py         # OpenAI integration
‚îÇ   ‚îú‚îÄ‚îÄ gerant_service.py
‚îÇ   ‚îú‚îÄ‚îÄ manager_service.py
‚îÇ   ‚îú‚îÄ‚îÄ seller_service.py
‚îÇ   ‚îú‚îÄ‚îÄ payment_service.py     # Stripe integration
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ api/routes/                # Presentation layer (21 routers)
    ‚îú‚îÄ‚îÄ auth.py               # 8 routes
    ‚îú‚îÄ‚îÄ manager.py            # 53 routes ‚ö†Ô∏è Le plus volumineux
    ‚îú‚îÄ‚îÄ gerant.py             # 45 routes
    ‚îú‚îÄ‚îÄ sellers.py            # 38 routes
    ‚îú‚îÄ‚îÄ stores.py             # 4 routes
    ‚îî‚îÄ‚îÄ ...
```

### Design Patterns Impl√©ment√©s

1. **Clean Architecture** (Robert C. Martin)
   - Routes ‚Üí Services ‚Üí Repositories ‚Üí Database
   - D√©pendances unidirectionnelles (ext√©rieur ‚Üí int√©rieur)

2. **Repository Pattern**
   - `BaseRepository` pour CRUD commun
   - Tous les repositories h√©ritent de `BaseRepository`

3. **Dependency Injection**
   - FastAPI `Depends()` pour services
   - `api/dependencies.py` pour factory functions

4. **Service Layer Pattern**
   - Logique m√©tier dans services, pas dans routes
   - Services utilisent repositories pour acc√®s DB

---

## üóÑÔ∏è COLLECTIONS MONGODB

### Collections Principales

| Collection | Usage | Indexes Critiques |
|------------|-------|-------------------|
| `users` | Utilisateurs (gerant, manager, seller) | `id` (unique) |
| `stores` | Magasins | `id`, `gerant_id`, `active` |
| `workspaces` | Espaces g√©rants (abonnements) | `id`, `gerant_id`, `stripe_subscription_id` |
| `kpi_entries` | KPIs vendeurs | `seller_id`, `date` (compos√©) |
| `manager_kpis` | KPIs managers | `manager_id`, `date`, `store_id` (compos√©) |
| `diagnostics` | Diagnostics DISC vendeurs | `seller_id` |
| `debriefs` | Debriefs vendeurs | `seller_id`, `created_at` |
| `objectives` | Objectifs managers | `store_id`, `manager_id` |
| `challenges` | D√©fis managers | `store_id`, `manager_id` |
| `subscriptions` | Abonnements Stripe | `user_id`, `stripe_subscription_id` (unique) |
| `api_keys` | Cl√©s API entreprise | `key_hash` (unique) |

### ‚ö†Ô∏è Indexes MongoDB (V√©rifi√©s)

- ‚úÖ `manager_kpis.manager_date_store_idx`: `(manager_id, date, store_id)`
- ‚úÖ `kpi_entries.seller_date_idx`: `(seller_id, date)`
- ‚úÖ `subscriptions.stripe_subscription_id_idx`: `(stripe_subscription_id)` unique

**‚ö†Ô∏è √Ä V√âRIFIER**: Indexes sur `debriefs(seller_id, created_at)` et autres collections fr√©quentes

---

## üîê S√âCURIT√â & AUTHENTIFICATION

### Syst√®me d'Authentification

- **JWT**: Token avec expiration 24h
- **Secret**: `JWT_SECRET` depuis `core.config.settings`
- **Algorithm**: HS256

### Dependencies d'Authentification

**NE PAS CR√âER DE NOUVELLES** - Utiliser celles existantes:

```python
# backend/core/security.py
from core.security import (
    get_current_user,        # User authentifi√© (tous r√¥les)
    get_current_manager,     # Manager uniquement
    get_current_gerant,      # G√©rant uniquement
    get_current_seller,      # Seller uniquement
    require_active_space     # V√©rifie abonnement actif
)
```

### V√©rifications de S√©curit√©

**Fonctions existantes** (NE PAS DUPLIQUER):

```python
# backend/core/security.py
verify_seller_store_access()      # V√©rifie acc√®s vendeur au magasin
verify_resource_store_access()    # V√©rifie acc√®s ressource (objectif/challenge)
verify_store_ownership()          # V√©rifie propri√©t√© magasin
```

**Pattern √† suivre**: Toujours filtrer par `store_id` dans la requ√™te MongoDB pour pr√©venir IDOR.

---

## üìä SERVICES EXISTANTS

### Services Disponibles (via Dependency Injection)

**NE PAS CR√âER DE NOUVEAUX SERVICES** sans v√©rifier d'abord si la logique existe d√©j√†:

```python
# backend/api/dependencies.py
from api.dependencies import (
    get_auth_service,           # AuthService
    get_kpi_service,            # KPIService
    get_ai_service,             # AIService (sans DB)
    get_ai_data_service,        # AIDataService (avec DB)
    get_store_service,           # StoreService
    get_gerant_service,          # GerantService
    get_manager_service,         # ManagerService
    get_seller_service,          # SellerService
    get_payment_service,         # PaymentService
    get_integration_service,     # IntegrationService
    get_notification_service,    # NotificationService
    get_conflict_service,        # ConflictService
    get_relationship_service,    # RelationshipService
    get_competence_service       # CompetenceService (Phase 3)
)
```

### Calculs de Comp√©tences

**‚ö†Ô∏è EXISTE D√âJ√Ä** - NE PAS DUPLIQUER:

- `backend/calculate_competences_and_levels.py` - Fonction `calculate_competence_scores_from_numeric_answers()`
- Utilis√©e dans: `backend/api/routes/manager.py:2724-2751` (inline - √Ä REFACTORER)

**Pattern √† suivre**: Cr√©er `services/competence_service.py` pour centraliser tous les calculs.

---

## üö´ ANTI-PATTERNS √Ä √âVITER

### ‚ùå NE JAMAIS FAIRE

1. **Business Logic dans Routes**
   - ‚ùå Calculs m√©tier directement dans `@router.get()`
   - ‚ùå Logique de calcul dans les routes (ex: calculs de comp√©tences)
   - ‚úÖ **Z√âRO logique de calcul dans les routes** - Tout dans les services
   - ‚úÖ Routes = validation input ‚Üí appel service ‚Üí retour r√©sultat

2. **Requ√™tes sans Pagination**
   - ‚ùå `.to_list(1000)` sans pagination
   - ‚úÖ Utiliser `paginate_with_params()` ou `paginate()` (max 100 items par page)

3. **Magic Numbers**
   - ‚ùå `.limit(5)`, `.to_list(100)`
   - ‚úÖ Constantes dans `config/limits.py`

4. **Duplication de V√©rifications S√©curit√©**
   - ‚ùå Nouvelle fonction `verify_*()` similaire
   - ‚úÖ R√©utiliser fonctions existantes dans `core/security.py`

5. **Requ√™tes MongoDB sans Index**
   - ‚ùå `find()` sur champs non index√©s
   - ‚úÖ V√©rifier indexes avant requ√™te

6. **Gestion d'Erreurs Incoh√©rente**
   - ‚ùå `except Exception: raise HTTPException(500)` ou `HTTPException(500)` en dur
   - ‚úÖ Utiliser exceptions m√©tier (`NotFoundError`, `ValidationError`, etc.) + `ErrorHandlerMiddleware`

---

## üìù PATTERNS √Ä SUIVRE

### 1. Cr√©ation d'un Nouvel Endpoint

```python
# ‚úÖ BON PATTERN
@router.get("/new-endpoint")
@limiter.limit("100/minute")  # ‚ö†Ô∏è Rate limiting obligatoire
async def new_endpoint(
    request: Request,  # ‚ö†Ô∏è Requis pour rate limiting
    current_user: dict = Depends(get_current_user),
    service: Service = Depends(get_service),
    db = Depends(get_db)
):
    try:
        # 1. V√©rification s√©curit√©
        await verify_access(...)
        
        # 2. Appel service (logique m√©tier)
        result = await service.do_something(...)
        
        # 3. Retour r√©ponse
        return result
    except CustomException as e:
        logger.error(f"Error: {e}")
        raise HTTPException(status_code=e.status_code, detail=str(e))
```

### 2. Pagination Standardis√©e

```python
# ‚úÖ √Ä IMPL√âMENTER (Phase 1)
from utils.pagination import PaginatedResponse

@router.get("/items")
async def get_items(
    page: int = Query(1, ge=1),
    limit: int = Query(20, ge=1, le=100),  # Max 100
    db = Depends(get_db)
):
    skip = (page - 1) * limit
    items = await db.collection.find({}).skip(skip).limit(limit).to_list(limit)
    total = await db.collection.count_documents({})
    
    return PaginatedResponse(
        items=items,
        page=page,
        limit=limit,
        total=total,
        pages=(total + limit - 1) // limit
    )
```

### 3. Gestion d'Erreurs

```python
# ‚úÖ IMPL√âMENT√â (Phase 1 - 27 Jan 2026)
from exceptions.custom_exceptions import (
    NotFoundError,
    ForbiddenError,
    ValidationError,
    UnauthorizedError,
    BusinessLogicError
)

# Dans le code
if not resource:
    raise NotFoundError("Resource not found")

# Middleware global (ErrorHandlerMiddleware) g√®re automatiquement:
# - Le logging structur√©
# - La conversion en r√©ponse HTTP avec le bon status_code
# - Le formatage de la r√©ponse JSON
```

---

## üîß CONFIGURATION

### Variables d'Environnement Requises

```python
# backend/core/config.py - Settings
MONGO_URL              # MongoDB connection string
DB_NAME                # Database name (default: "retail_coach")
JWT_SECRET             # Secret pour JWT
OPENAI_API_KEY         # Cl√© API OpenAI
STRIPE_API_KEY         # Cl√© API Stripe
STRIPE_WEBHOOK_SECRET  # Secret webhook Stripe
BREVO_API_KEY          # Cl√© API Brevo (email)
FRONTEND_URL           # URL frontend (CORS)
```

### Limites Actuelles (√Ä Externaliser)

```python
# ‚ö†Ô∏è MAGIC NUMBERS - √Ä D√âPLACER DANS config/limits.py
maxPoolSize=10              # MongoDB pool (‚ö†Ô∏è TROP FAIBLE)
JWT_EXPIRATION=24           # heures
PAGINATION_MAX=100          # items par page
RATE_LIMIT_IA=10            # req/min (endpoints IA)
RATE_LIMIT_READ=100         # req/min (endpoints lecture)
DEBRIEFS_LIMIT=5            # derniers debriefs
```

---

## üóÇÔ∏è ORGANISATION DES DOCUMENTS

### Structure des Docs

```
docs/
‚îú‚îÄ‚îÄ archive/              # Documents archiv√©s par date
‚îÇ   ‚îú‚îÄ‚îÄ 2024-12/         # D√©cembre 2024
‚îÇ   ‚îú‚îÄ‚îÄ 2025-01/         # Janvier 2025
‚îÇ   ‚îî‚îÄ‚îÄ 2025-02/         # F√©vrier 2025
‚îî‚îÄ‚îÄ [docs actifs]        # Documents de r√©f√©rence actuels
```

### Documents de R√©f√©rence (√Ä GARDER √Ä JOUR)

- `AUDIT_ARCHITECTURAL_CRITIQUE.md` - Audit complet (27 Jan 2026)
- `SYNTHESE_ARCHITECTURE_POST_REFACTORING.md` - Architecture actuelle
- `REFACTORING_SUMMARY.md` - R√©sum√© refactoring
- `CHANGELOG.md` - Historique des changements
- `.cursorrules` - **CE DOCUMENT** (source de v√©rit√©)

### Documents √† Archiver

- Tous les `AUDIT_*.md` (sauf le dernier)
- Tous les `VAGUE_*.md` (optimisations termin√©es)
- Tous les `CORRECTION_*.md` (corrections appliqu√©es)
- Tous les `RESUME_*.md` (r√©sum√©s de t√¢ches termin√©es)

---

## üöÄ D√âPLOIEMENT

### Configuration Production

- **Backend**: FastAPI sur port 8080
- **Frontend**: React build sur Vercel
- **Database**: MongoDB (connection pool: 50 ‚úÖ Production-ready, configurable via MONGO_MAX_POOL_SIZE)
- **Rate Limiting**: slowapi (10/min IA, 100/min lecture)
- **Timeouts**: connectTimeoutMS=5000ms, socketTimeoutMS=30000ms ‚úÖ Production-ready

### Endpoints Critiques

- `POST /api/ai/*` - Rate limit 10/min (co√ªt OpenAI)
- `GET /api/manager/*` - Rate limit 100/min (scraping)
- `POST /api/webhooks/stripe` - ‚ö†Ô∏è Synchrone (√Ä d√©placer en background)

---

## ‚ö†Ô∏è PROBL√àMES CONNUS √Ä R√âSOUDRE

### Phase 1 (Critique) - ‚úÖ TERMIN√â

1. ‚úÖ **Error Handling**: Middleware global + exceptions custom (TERMIN√â)
2. ‚úÖ **Pagination**: Syst√®me standardis√© cr√©√© (en cours d'extension)
3. ‚úÖ **Extraction Services**: `get_seller_stats()` refactor√© (TERMIN√â)

### Phase 1 (Critique) - EN COURS

4. **Pagination**: √âtendre √† toutes les routes (76 occurrences restantes)
5. **Pool MongoDB**: `maxPoolSize=10` ‚Üí `50-100`

### Phase 2 (Majeur) - Cette Semaine

7. **Cache Redis**: User lookups, diagnostics, stats
8. **Rate Limiting**: √âtendre √† tous les endpoints
9. ‚úÖ **Indexes MongoDB**: Script `ensure_indexes.py` cr√©√© (√† ex√©cuter lors du d√©ploiement)

### Phase 3 (Am√©lioration) - Mois Prochain

8. **Background Tasks**: Celery pour webhooks Stripe
9. **Monitoring**: Prometheus + structured logging
10. **Tests**: Couverture >60%

---

## üìö R√âF√âRENCES IMPORTANTES

### Fichiers Cl√©s √† Consulter

- `backend/main.py` - Configuration FastAPI, middlewares
- `backend/core/security.py` - Authentification, RBAC
- `backend/core/database.py` - Connection MongoDB
- `backend/api/dependencies.py` - Dependency injection
- `backend/services/` - Logique m√©tier
- `backend/repositories/` - Acc√®s donn√©es

### Documentation Externe

- FastAPI: https://fastapi.tiangolo.com/
- Motor (MongoDB async): https://motor.readthedocs.io/
- Pydantic: https://docs.pydantic.dev/
- OpenAI SDK: https://github.com/openai/openai-python

---

## ‚úÖ CHECKLIST AVANT COMMIT

Avant chaque commit, v√©rifier:

- [ ] Pas de duplication de code (v√©rifier services/repositories existants)
- [ ] Pagination impl√©ment√©e (pas de `.to_list(1000)`)
- [ ] Rate limiting ajout√© sur nouveaux endpoints
- [ ] Gestion d'erreurs coh√©rente (exceptions custom)
- [ ] Logging structur√© ajout√©
- [ ] Tests unitaires pour nouvelle logique m√©tier
- [ ] Documentation mise √† jour si n√©cessaire
- [ ] **`.cursorrules` mis √† jour** si changement architectural

---

## üîÑ PROCESSUS DE MISE √Ä JOUR

### Quand Mettre √† Jour `.cursorrules`

**OBLIGATOIRE** lors de:
- ‚úÖ Ajout d'un nouveau service
- ‚úÖ Ajout d'une nouvelle collection MongoDB
- ‚úÖ Changement d'architecture (nouveau pattern)
- ‚úÖ Ajout d'un nouveau syst√®me d'authentification
- ‚úÖ Modification des indexes MongoDB
- ‚úÖ Changement de configuration critique

**Format de mise √† jour**:
```markdown
## [Date] - [Type de changement]
- Ajout√©: [description]
- Modifi√©: [description]
- Supprim√©: [description]
```

---

## üéØ R√àGLES DE D√âVELOPPEMENT

### 1. Principe DRY (Don't Repeat Yourself)

**AVANT d'√©crire du code**:
1. Chercher dans `services/` si la logique existe
2. Chercher dans `repositories/` si l'acc√®s DB existe
3. Chercher dans `core/security.py` si la v√©rification existe
4. Si trouv√© ‚Üí **R√âUTILISER**, sinon cr√©er

### 2. Principe Single Responsibility

- **Routes**: Uniquement validation input/output, appels services
- **Services**: Logique m√©tier pure
- **Repositories**: Acc√®s donn√©es uniquement
- **Models**: Validation donn√©es uniquement

### 3. Principe Open/Closed

- **Extension**: Ajouter nouvelles routes/services sans modifier existants
- **Modification**: Utiliser h√©ritage ou composition, pas modification directe

### 4. Tests Obligatoires

- **Services**: Tests unitaires (mock repositories)
- **Repositories**: Tests d'int√©gration (test DB)
- **Routes**: Tests E2E (test HTTP)

---

## üìä M√âTRIQUES DE QUALIT√â

### Objectifs Actuels

- **Temps de r√©ponse moyen**: <200ms (actuellement ~800ms)
- **Temps de r√©ponse P95**: <1s (actuellement ~3.5s)
- **M√©moire par requ√™te**: <2MB (actuellement ~15MB)
- **Requ√™tes DB par endpoint**: 1-2 (actuellement 5-10)
- **Code dupliqu√©**: <5% (actuellement ~30%)
- **Couverture tests**: >80% (actuellement ~20%)

---

## üö® ALERTES CRITIQUES

### ‚ö†Ô∏è NE JAMAIS

1. **Modifier `core/security.py`** sans v√©rifier tous les endpoints qui l'utilisent
2. **Changer les indexes MongoDB** sans migration planifi√©e
3. **Supprimer un service** sans v√©rifier toutes les d√©pendances
4. **Modifier les mod√®les Pydantic** sans v√©rifier la compatibilit√© DB
5. **Ajouter une d√©pendance** sans mettre √† jour `requirements.txt` ET `vercel.json`

### ‚úÖ TOUJOURS

1. **V√©rifier les indexes** avant requ√™te MongoDB complexe
2. **Ajouter rate limiting** sur nouveaux endpoints
3. **Utiliser pagination** pour listes
4. **Logger les erreurs** avec contexte
5. **Tester localement** avant commit

---

---

## üìù HISTORIQUE DES MODIFICATIONS

### [27 Janvier 2026] - Phase 1: Centralisation Gestion d'Erreurs
- ‚úÖ Ajout√©: `backend/exceptions/custom_exceptions.py` - Exceptions personnalis√©es
- ‚úÖ Ajout√©: `backend/api/middleware/error_handler.py` - Middleware global de gestion d'erreurs
- ‚úÖ Modifi√©: `backend/main.py` - Enregistrement du middleware ErrorHandlerMiddleware
- ‚úÖ Modifi√©: `backend/api/routes/auth.py` - Refactoring routes avec nouvelles exceptions
- ‚úÖ Modifi√©: `backend/services/auth_service.py` - Utilisation UnauthorizedError au lieu de Exception g√©n√©rique

### [27 Janvier 2026] - Phase 2: Pagination Standardis√©e
- ‚úÖ Ajout√©: `backend/models/pagination.py` - Mod√®le `PaginatedResponse` g√©n√©rique
- ‚úÖ Ajout√©: `backend/utils/pagination.py` - Fonction `paginate()` avec `asyncio.gather` pour performance
- ‚úÖ Ajout√©: `backend/config/limits.py` - Constantes centralis√©es (DEFAULT_PAGE_SIZE, MAX_PAGE_SIZE, etc.)
- ‚úÖ Modifi√©: `backend/api/routes/manager.py` - Refactoring `get_seller_kpi_entries()` avec pagination
- ‚úÖ Modifi√©: `backend/models/__init__.py` - Export de `PaginatedResponse` et `PaginationParams`

### [27 Janvier 2026] - Phase 3: Extraction Logique M√©tier
- ‚úÖ Ajout√©: `backend/services/competence_service.py` - Service centralis√© pour calculs de comp√©tences
- ‚úÖ Modifi√©: `backend/api/routes/manager.py` - Refactoring `get_seller_stats()` (175 lignes ‚Üí ~60 lignes)
- ‚úÖ Modifi√©: `backend/api/dependencies.py` - Ajout `get_competence_service()`
- ‚úÖ Modifi√©: `backend/services/__init__.py` - Export de `CompetenceService`

### [27 Janvier 2026] - Phase 4: Optimisation Infrastructure
- ‚úÖ Modifi√©: `backend/core/config.py` - Ajout variables MongoDB (MONGO_MAX_POOL_SIZE, timeouts)
- ‚úÖ Modifi√©: `backend/core/database.py` - Pool size augment√© √† 50, timeouts optimis√©s (production-ready)
- ‚úÖ Ajout√©: `backend/scripts/ensure_indexes.py` - Script d'indexation pour d√©ploiement
- ‚úÖ Modifi√©: `.cursorrules` - Documentation configuration production-ready

### [28 Janvier 2026] - Phase 5: Qualit√© & P√©rennit√© (Finalisation)
- ‚úÖ Section **R√àGLES CRITIQUES (Architecture Backend)** - Architecture (Services/Repositories inject√©s), Erreurs (pas HTTPException 500), Pagination (pas .to_list(1000)), Logs (logger jamais print)
- ‚úÖ Renforc√©: Anti-pattern gestion d'erreurs (exceptions m√©tier obligatoires)
- ‚úÖ Tests: `backend/tests/test_payment_repository.py` - Preuve de testabilit√© : `PaymentTransactionRepository` test√© avec `unittest.mock` (DB mock√©e, pas de MongoDB r√©el)

---

*Document cr√©√© le 27 Janvier 2026 - √Ä mettre √† jour √† chaque modification significative*
